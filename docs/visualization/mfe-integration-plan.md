# HMS-MFE Documentation & Animation Integration Plan

## Executive Summary
This plan details how to analyse the existing **@HMS-MFE** Vue 3 application, extend it so that the platform's rich Markdown documentation (including Mermaid diagrams) can be rendered _inside the MFE_, and wire-up the new **HMS Unified Animation Framework** so that animated diagrams play seamlessly alongside static docs.  It complements and extends `ANIMATION_OVERVIEW.md` and the Government specific plan.

---

## 1. Objectives
1. Provide an in-app doc browser so that all markdown files in `docs/**` (and autogenerated docs) are viewable within HMS-MFE.
2. Render Mermaid diagrams automatically and attach the shared `AnimationController` so that diagrams that include an `animationConfig` block play interactively.
3. Keep bundle size, performance and accessibility in line with HMS standards.

---

## 2. Discovery & Analysis
| # | Activity | Purpose |
|---|----------|---------|
| 2.1 | Clone/locate **@HMS-MFE** repo (if mono-repo, inspect `mfe/` folder). | Identify tech stack (Vue version, Vite/Webpack, TypeScript usage). |
| 2.2 | Run `npm run dev` to confirm local dev server and observe folder structure (`src/components`, `src/router`, `src/assets`, etc.). | Spot best insertion points for docs & diagram components. |
| 2.3 | Search for existing markdown rendering or Mermaid usage. | Decide whether to extend or replace. |
| 2.4 | Audit global CSS / Tailwind / design-system. | Determine how to merge `animation.css` without conflicts. |
| 2.5 | Review current CI/CD (GitHub Actions) and linting rules. | Plan dependency additions and test coverage. |

> Initial output artefact: **`analysis-mfe-integration.md`** summarising findings (generated automatically by tooling script).

---

## 3. Technical Approach
### 3.1 Documentation Rendering
1. **Markdown Engine**: Use `markdown-it` with plugins:
   * `markdown-it-anchor` – heading anchors for deep-linking.
   * `markdown-it-toc-done-right` – auto-generated TOCs.
   * **`markdown-it-mermaid`** (or custom wrapper) – convert Mermaid code blocks to `<div class="mermaid">` nodes.
2. **Vue Component**: `<DocViewer :path="/docs/some/file.md"/>`
   * Fetches and caches `.md` files via dynamic import or network fetch.
   * Renders to HTML using the engine above.
   * Emits `diagram-mounted` events whenever a mermaid diagram is rendered so that animation can attach.
3. **Router**: Add `/docs/:docPath(.*)` route with a lazy-loaded `DocsPage.vue` that hosts `<DocViewer>`.

### 3.2 Mermaid + Animation Support
1. **Mermaid Loader**: Import Mermaid (`import mermaid from 'mermaid'`) and initialise once globally.
2. **Animation Attachment**: After Mermaid renders, inspect diagram element for a sibling `<script type="application/json" class="hms-animation-config">` or fetch a generated `*.animation.json` referenced via `data-animation` attribute.
3. **Shared Assets**:
   * Copy (or symlink during build) `src/visualization/animation.css` into MFE global styles (`src/assets/animation.css`).
   * transpile `src/visualization/controller.ts` into ES build and expose as `@hms/animation` package or direct import.
4. **Vue Wrapper Component**: `<AnimatedDiagram :diagram="mermaidSrc" :config="animationConfig"/>` that internally instantiates `AnimationController`.

### 3.3 Data Pipeline
* Extend `scripts/generate-docs.ts` so that for each `.md` with diagrams that require animation it also emits `*.animation.json` (matching the Controller config) into `public/docs/animations/` (served statically by Vite).
* Add a manifest `docs-manifest.json` listing docs and metadata for sidebar navigation.

---

## 4. Task Breakdown & Timeline
| Phase | Duration | Key Deliverables |
|-------|----------|------------------|
| 0. Prep | 0.5 d | Confirm access to `@HMS-MFE` repo, open branch `feat/docs-animation`. |
| 1. Analysis | 1 d | Complete section 2 activities, publish `analysis-mfe-integration.md`. |
| 2. Dependencies | 0.5 d | Add `markdown-it`, `mermaid`, `markdown-it-anchor`, etc.; update `package.json`. |
| 3. Components | 2 d | `DocViewer.vue`, `MermaidDiagram.vue`, `AnimatedDiagram.vue`. |
| 4. Styling | 0.5 d | Integrate `animation.css`, ensure theme variables. |
| 5. Routing & Nav | 0.5 d | `/docs` route, sidebar with manifest. |
| 6. Pipeline | 1 d | Enhance `generate-docs.ts`, CI updates. |
| 7. QA & A11y | 1 d | Keyboard focus trap, reduced-motion support, screen-reader labels. |
| 8. Docs & Training | 0.5 d | Update `README.md` and developer guide for MFE. |
| **Total** | **~7 d** | -- |

---

## 5. Accessibility & Performance
* Respect `prefers-reduced-motion`: controller pauses animations automatically.
* Use `aria-live` regions in `AnimatedDiagram` to announce step descriptions.
* Lazy-load Mermaid JS only when a diagram is present (code-split via `import('mermaid')`).
* Ensure Lighthouse animation-heavy pages score ≥ 90 performance.

---

## 6. Risks & Mitigations
| Risk | Impact | Mitigation |
|------|--------|-----------|
| Bundle size increase | Slower load | Code-splitting, external CDN for Mermaid. |
| CSS conflicts | Visual bugs | Scope animation styles under `.hms-diagram` parent. |
| Incorrect selector mapping | Animations fail | Add unit tests utilising Jest + `@testing-library/vue`. |
| Security of loading external MD | XSS | Sanitize HTML via `DOMPurify` post-render. |

---

## 7. Success Metrics
1. Documentation renders inside MFE with zero console errors.
2. Animated diagram demo renders at ≥ 30 fps on reference hardware.
3. Lighthouse accessibility score ≥ 95 on docs pages.
4. CI passes with ≤ 5 % increase in bundle size (gzipped).

---

## 8. Next Steps
1. Approve this plan and create tracking ticket `MFE-#123 Docs & Animation Integration` with sub-tasks per phase.
2. Begin **Phase 1 – Analysis**. 